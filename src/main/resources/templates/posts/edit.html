<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>

<body>
<div th:replace="fragments/navbar :: myNav"></div>

<!--th:object required if using form-binding and only works withing the scope of its use-->
<form th:action="@{/posts/{id}/edit(id=${post.id})}" method="post" th:object="${post}">

    Title:
                    <!--this structure only happens in the field-->
    <input th:field="*{title}" />
    <br />
    Description:
    <input th:field="*{body}" />
    <br />

    <input type="submit" class="btn btn-success" />

    <!--&lt;!&ndash;create a form method that contains a input type that submits the form to delete the post&ndash;&gt;-->
    <!--<form th:action="@{posts/{id}/delete(id=${post.id})}" method="post" th:object="${post}">-->
        <!--<input type="submit" value="Delete" />-->
    <!--</form>-->

    <input type="hidden" id="postId" th:value="${post.id}"/>
    <button id="deletePost" class="btn btn-danger">Delete</button>

</form>


<div th:replace="fragments/footer :: footer"></div>

<!--class example to use javascript/fetch with delete button -->
<script>
    let deleted = document.querySelector("deletePost");
    let postId = document.querySelector("#postId").value;

    deleted.addEventListener('click', function(e){
        e.preventDefault();
        let result = confirm("Do you want to delete this post?");
        if(result){

            fetch(`/posts/${postId}/delete`, {
                method: "POST"
            }).then(result => result.json()).then( result => location.href="/posts");
        }
    })
</script>

</body>
</html>